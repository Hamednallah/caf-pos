package com.yourcompany.cafeteria.dao; import org.junit.jupiter.api.*; import java.sql.Connection; import static org.junit.jupiter.api.Assertions.*; import com.yourcompany.cafeteria.util.TestDatabase; import com.yourcompany.cafeteria.model.Order; import com.yourcompany.cafeteria.model.OrderItem; import java.math.BigDecimal; import java.util.List; public class OrdersDAOTest { Connection conn; @BeforeEach public void setup() throws Exception { conn = TestDatabase.open(); } @AfterEach public void teardown() throws Exception { conn.close(); } @Test public void createOrderTransactional() throws Exception { ItemsDAO itemsDAO = new ItemsDAO(conn); com.yourcompany.cafeteria.model.Item item = new com.yourcompany.cafeteria.model.Item(); item.setName("OItem"); item.setPrice(new BigDecimal("5.00")); int itemId = itemsDAO.insert(item); Order o = new Order(); o.cashierId = 1; o.status = "FINALIZED"; o.paymentMethod = "CASH"; o.paymentConfirmed = true; o.totalAmount = new BigDecimal("5.00"); OrderItem oi = new OrderItem(); oi.setItemId(itemId); oi.setQuantity(1); oi.setLineTotal(new BigDecimal("5.00")); o.items = List.of(oi); OrdersDAO dao = new OrdersDAO(conn); int orderId = dao.createOrderTransactional(o); assertTrue(orderId>0); OrderItemsDAO oidao = new OrderItemsDAO(conn); var items = oidao.listByOrderId(orderId); assertEquals(1, items.size()); assertEquals(itemId, items.get(0).getItemId()); } }
